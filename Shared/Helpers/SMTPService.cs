using System;
using System.Collections.Generic;
using System.Linq;
using System.Net.Mail;
using System.Net;
using System.Text;
using System.Threading.Tasks;
using Shared.Interfaces;
using System.Net.Http;
using Shared.SettingsModels;
using Microsoft.Extensions.Options;
using Shared.ViewModels.Legalization;
using Shared.Enums;

namespace Shared.Helpers
{
    public class SMTPService : ISMTPService
    {
        private readonly SMTPServiceSettings _smtpServiceSettings;

        public SMTPService(IOptions<SMTPServiceSettings> smtpServiceSettings)
        {
            _smtpServiceSettings = smtpServiceSettings.Value;
        }



        public async Task SendMail(LegalizationDetails legalizationDetails, LegalizationStatus legalizationStatus)
        {
            var username = _smtpServiceSettings.Username;
            var password = _smtpServiceSettings.Password;

            var smtpClient = new SmtpClient(_smtpServiceSettings.SMTPClient)
            {
                Port = 587,
                Credentials = new NetworkCredential(username, password),
                EnableSsl = true,
            };
            
            var status = "";

            if(legalizationDetails != null) 
            {
                if (legalizationStatus == Enums.LegalizationStatus.Approved) 
                    status = "Aprobado";
                if (legalizationStatus == Enums.LegalizationStatus.Deny) 
                    status = "Denegado";
                if (legalizationStatus == Enums.LegalizationStatus.Paid) 
                    status = "Pagado";
            }

            var subject = "Notificación de Cambio de Estatus de Legalización";

            //smtpClient.Send(_smtpServiceSettings.Username, legalizationDetails?.User?.Email, subject, message);

            var mailMessage = new MailMessage
            {
                From = new MailAddress(username),
                Subject = subject,
                Body = $"<!doctype html>\r\n    <html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\">\r\n      <head>\r\n        <title>\r\n          \r\n        </title>\r\n        <!--[if !mso]><!-- -->\r\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n        <!--<![endif]-->\r\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n        <style type=\"text/css\">\r\n          #outlook a {{ padding:0; }}\r\n          body {{ margin:0;padding:0;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%; }}\r\n          table, td {{ border-collapse:collapse;mso-table-lspace:0pt;mso-table-rspace:0pt; }}\r\n          img {{ border:0;height:auto;line-height:100%; outline:none;text-decoration:none;-ms-interpolation-mode:bicubic; }}\r\n          p {{ display:block;margin:13px 0; }}\r\n        </style>\r\n        <!--[if mso]>\r\n        <xml>\r\n        <o:OfficeDocumentSettings>\r\n          <o:AllowPNG/>\r\n          <o:PixelsPerInch>96</o:PixelsPerInch>\r\n        </o:OfficeDocumentSettings>\r\n        </xml>\r\n        <![endif]-->\r\n        <!--[if lte mso 11]>\r\n        <style type=\"text/css\">\r\n          .outlook-group-fix {{ width:100% !important; }}\r\n        </style>\r\n        <![endif]-->\r\n        \r\n      <!--[if !mso]><!-->\r\n        <link href=\"https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700\" rel=\"stylesheet\" type=\"text/css\">\r\n<link href=\"https://fonts.googleapis.com/css?family=Poppins:400,700\" rel=\"stylesheet\" type=\"text/css\">\r\n<link href=\"https://fonts.googleapis.com/css?family=Merriweather:400,700\" rel=\"stylesheet\" type=\"text/css\">\r\n        <style type=\"text/css\">\r\n          @import url(https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700);\r\n@import url(https://fonts.googleapis.com/css?family=Poppins:400,700);\r\n@import url(https://fonts.googleapis.com/css?family=Merriweather:400,700);\r\n        </style>\r\n      <!--<![endif]-->\r\n\r\n    \r\n        \r\n    <style type=\"text/css\">\r\n      @media only screen and (max-width:480px) {{\r\n        .mj-column-per-100 {{ width:100% !important; max-width: 100%; }}\r\n      }}\r\n    </style>\r\n    \r\n  \r\n        <style type=\"text/css\">\r\n        \r\n        \r\n\r\n    @media only screen and (max-width:480px) {{\r\n      table.full-width-mobile {{ width: 100% !important; }}\r\n      td.full-width-mobile {{ width: auto !important; }}\r\n    }}\r\n  \r\n        </style>\r\n        <style type=\"text/css\">.hide_on_mobile {{ display: none !important;}} \r\n        @media only screen and (min-width: 480px) {{ .hide_on_mobile {{ display: block !important;}} }}\r\n        .hide_section_on_mobile {{ display: none !important;}} \r\n        @media only screen and (min-width: 480px) {{ \r\n            .hide_section_on_mobile {{ \r\n                display: table !important;\r\n            }} \r\n\r\n            div.hide_section_on_mobile {{ \r\n                display: block !important;\r\n            }}\r\n        }}\r\n        .hide_on_desktop {{ display: block !important;}} \r\n        @media only screen and (min-width: 480px) {{ .hide_on_desktop {{ display: none !important;}} }}\r\n        .hide_section_on_desktop {{ \r\n            display: table !important;\r\n            width: 100%;\r\n        }} \r\n        @media only screen and (min-width: 480px) {{ .hide_section_on_desktop {{ display: none !important;}} }}\r\n        \r\n          p, h1, h2, h3 {{\r\n              margin: 0px;\r\n          }}\r\n\r\n          ul, li, ol {{\r\n            font-size: 11px;\r\n            font-family: Ubuntu, Helvetica, Arial;\r\n          }}\r\n\r\n          a {{\r\n              text-decoration: none;\r\n              color: inherit;\r\n          }}\r\n\r\n          @media only screen and (max-width:480px) {{\r\n\r\n            .mj-column-per-100 {{ width:100%!important; max-width:100%!important; }}\r\n            .mj-column-per-100 > .mj-column-per-75 {{ width:75%!important; max-width:75%!important; }}\r\n            .mj-column-per-100 > .mj-column-per-60 {{ width:60%!important; max-width:60%!important; }}\r\n            .mj-column-per-100 > .mj-column-per-50 {{ width:50%!important; max-width:50%!important; }}\r\n            .mj-column-per-100 > .mj-column-per-40 {{ width:40%!important; max-width:40%!important; }}\r\n            .mj-column-per-100 > .mj-column-per-33 {{ width:33.333333%!important; max-width:33.333333%!important; }}\r\n            .mj-column-per-100 > .mj-column-per-25 {{ width:25%!important; max-width:25%!important; }}\r\n\r\n            .mj-column-per-100 {{ width:100%!important; max-width:100%!important; }}\r\n            .mj-column-per-75 {{ width:100%!important; max-width:100%!important; }}\r\n            .mj-column-per-60 {{ width:100%!important; max-width:100%!important; }}\r\n            .mj-column-per-50 {{ width:100%!important; max-width:100%!important; }}\r\n            .mj-column-per-40 {{ width:100%!important; max-width:100%!important; }}\r\n            .mj-column-per-33 {{ width:100%!important; max-width:100%!important; }}\r\n            .mj-column-per-25 {{ width:100%!important; max-width:100%!important; }}\r\n        }}</style>\r\n        \r\n      </head>\r\n      <body style=\"background-color:#e6e6e6;\">\r\n        \r\n        \r\n      <div style=\"background-color:#e6e6e6;\">\r\n        \r\n      \r\n      <!--[if mso | IE]>\r\n      <table\r\n         align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"\" style=\"width:600px;\" width=\"600\"\r\n      >\r\n        <tr>\r\n          <td style=\"line-height:0px;font-size:0px;mso-line-height-rule:exactly;\">\r\n      <![endif]-->\r\n    \r\n      \r\n      <div style=\"background:#FFFFFF;background-color:#FFFFFF;margin:0px auto;max-width:600px;\">\r\n        \r\n        <table align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"background:#FFFFFF;background-color:#FFFFFF;width:100%;\">\r\n          <tbody>\r\n            <tr>\r\n              <td style=\"direction:ltr;font-size:0px;padding:0px 0px 0px 0px;text-align:center;\">\r\n                <!--[if mso | IE]>\r\n                  <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\r\n                \r\n        <tr>\r\n      \r\n            <td\r\n               class=\"\" style=\"vertical-align:top;width:600px;\"\r\n            >\r\n          <![endif]-->\r\n            \r\n      <div class=\"mj-column-per-100 outlook-group-fix\" style=\"font-size:0px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%;\">\r\n        \r\n      <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"vertical-align:top;\" width=\"100%\">\r\n        \r\n      </table>\r\n    \r\n      </div>\r\n    \r\n          <!--[if mso | IE]>\r\n            </td>\r\n          \r\n        </tr>\r\n      \r\n                  </table>\r\n                <![endif]-->\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n        \r\n      </div>\r\n    \r\n      \r\n      <!--[if mso | IE]>\r\n          </td>\r\n        </tr>\r\n      </table>\r\n      \r\n      <table\r\n         align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"\" style=\"width:600px;\" width=\"600\"\r\n      >\r\n        <tr>\r\n          <td style=\"line-height:0px;font-size:0px;mso-line-height-rule:exactly;\">\r\n      <![endif]-->\r\n    \r\n      \r\n      <div style=\"background:#FFFFFF;background-color:#FFFFFF;margin:0px auto;max-width:600px;\">\r\n        \r\n        <table align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"background:#FFFFFF;background-color:#FFFFFF;width:100%;\">\r\n          <tbody>\r\n            <tr>\r\n              <td style=\"direction:ltr;font-size:0px;padding:10px 0px 10px 0px;text-align:center;\">\r\n                <!--[if mso | IE]>\r\n                  <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\r\n                \r\n        <tr>\r\n      \r\n            <td\r\n               class=\"\" style=\"vertical-align:top;width:600px;\"\r\n            >\r\n          <![endif]-->\r\n            \r\n      <div class=\"mj-column-per-100 outlook-group-fix\" style=\"font-size:0px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%;\">\r\n        \r\n      <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"vertical-align:top;\" width=\"100%\">\r\n        \r\n            <tr>\r\n              <td align=\"left\" style=\"font-size:0px;padding:15px 15px 15px 15px;word-break:break-word;\">\r\n                \r\n      <div style=\"font-family:Poppins, sans-serif;font-size:13px;line-height:1.5;text-align:left;color:#000000;\"><h1 style=\"font-family: Poppins, sans-serif; font-size: 24px; text-align: center;\"><span style=\"color: rgb(0, 74, 152);\"><em><span style=\"font-family: Merriweather, Georgia, serif;\">Estimado(a) {legalizationDetails?.User?.Name}</span></em></span></h1></div>\r\n    \r\n              </td>\r\n            </tr>\r\n          \r\n            <tr>\r\n              <td align=\"left\" style=\"font-size:0px;padding:15px 15px 15px 15px;word-break:break-word;\">\r\n                \r\n      <div style=\"font-family:Ubuntu, Helvetica, Arial, sans-serif;font-size:13px;line-height:1.5;text-align:left;color:#000000;\"><p style=\"font-size: 12px; font-family: Poppins, sans-serif; text-align: center;\"><span style=\"color: rgb(0, 0, 0);\"><span style=\"background-color: rgb(255, 255, 255);\">Luego de un cordial saludo, nos place informarle que la legalizacion de {legalizationDetails.DocumentType?.Name} ha cambiado de estatus a {status}</span></span></p></div>\r\n    \r\n              </td>\r\n            </tr>\r\n          \r\n            <tr>\r\n              <td align=\"center\" vertical-align=\"middle\" style=\"font-size:0px;padding:20px 20px 20px 20px;word-break:break-word;\">\r\n                \r\n      <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"border-collapse:separate;width:100%;line-height:100%;\">\r\n        <tr>\r\n          <td align=\"center\" bgcolor=\"transparent\" role=\"presentation\" style=\"border:2px #004a98 solid;border-radius:12px;cursor:auto;mso-padding-alt:18px 26px 18px 26px;background:transparent;\" valign=\"middle\">\r\n            <a href=\"https://mescyt.gob.do/\" style=\"display: inline-block; background: transparent; color: #004a98; font-family: Poppins, sans-serif; font-size: 20px; font-weight: normal; line-height: 25px; margin: 0; text-decoration: none; text-transform: none; padding: 18px 26px 18px 26px; mso-padding-alt: 0px; border-radius: 12px;\" target=\"_blank\">\r\n              <span><span style=\"font-size: 20px;\"><strong>Ir a la MESCYT</strong></span></span>\r\n            </a>\r\n          </td>\r\n        </tr>\r\n      </table>\r\n    \r\n              </td>\r\n            </tr>\r\n          \r\n      </table>\r\n    \r\n      </div>\r\n    \r\n          <!--[if mso | IE]>\r\n            </td>\r\n          \r\n        </tr>\r\n      \r\n                  </table>\r\n                <![endif]-->\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n        \r\n      </div>\r\n    \r\n      \r\n      <!--[if mso | IE]>\r\n          </td>\r\n        </tr>\r\n      </table>\r\n      \r\n      <table\r\n         align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"\" style=\"width:600px;\" width=\"600\"\r\n      >\r\n        <tr>\r\n          <td style=\"line-height:0px;font-size:0px;mso-line-height-rule:exactly;\">\r\n      <![endif]-->\r\n    \r\n      \r\n      <div style=\"background:#FFFFFF;background-color:#FFFFFF;margin:0px auto;max-width:600px;\">\r\n        \r\n        <table align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"background:#FFFFFF;background-color:#FFFFFF;width:100%;\">\r\n          <tbody>\r\n            <tr>\r\n              <td style=\"direction:ltr;font-size:0px;padding:10px 0px 10px 0px;text-align:center;\">\r\n                <!--[if mso | IE]>\r\n                  <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\r\n                \r\n        <tr>\r\n      \r\n            <td\r\n               class=\"\" style=\"vertical-align:top;width:600px;\"\r\n            >\r\n          <![endif]-->\r\n            \r\n      <div class=\"mj-column-per-100 outlook-group-fix\" style=\"font-size:0px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%;\">\r\n        \r\n      <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"vertical-align:top;\" width=\"100%\">\r\n        \r\n            <tr>\r\n              <td style=\"font-size:0px;padding:10px 10px;padding-top:10px;word-break:break-word;\">\r\n                \r\n      <p style=\"font-family: Poppins, sans-serif; border-top: solid 1px #004a98; font-size: 1; margin: 0px auto; width: 100%;\">\r\n      </p>\r\n      \r\n      <!--[if mso | IE]>\r\n        <table\r\n           align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-top:solid 1px #004a98;font-size:1;margin:0px auto;width:580px;\" role=\"presentation\" width=\"580px\"\r\n        >\r\n          <tr>\r\n            <td style=\"height:0;line-height:0;\">\r\n              &nbsp;\r\n            </td>\r\n          </tr>\r\n        </table>\r\n      <![endif]-->\r\n    \r\n    \r\n              </td>\r\n            </tr>\r\n          \r\n            <tr>\r\n              <td style=\"font-size:0px;word-break:break-word;\">\r\n                \r\n      \r\n    <!--[if mso | IE]>\r\n    \r\n        <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr><td height=\"20\" style=\"vertical-align:top;height:20px;\">\r\n      \r\n    <![endif]-->\r\n  \r\n      <div style=\"height:20px;\">\r\n        &nbsp;\r\n      </div>\r\n      \r\n    <!--[if mso | IE]>\r\n    \r\n        </td></tr></table>\r\n      \r\n    <![endif]-->\r\n  \r\n    \r\n              </td>\r\n            </tr>\r\n          \r\n            <tr>\r\n              <td align=\"center\" style=\"font-size:0px;padding:0px 0px 0px 0px;word-break:break-word;\">\r\n                \r\n      <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"border-collapse:collapse;border-spacing:0px;\">\r\n        <tbody>\r\n          <tr>\r\n            <td style=\"width:150px;\">\r\n              \r\n      <img height=\"auto\" src=\"https://storage.googleapis.com/topolio39774/plugin-assets/6320/39774/Logo%20legalizacion.png\" style=\"border:0;display:block;outline:none;text-decoration:none;height:auto;width:100%;font-size:13px;\" width=\"150\">\r\n    \r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    \r\n              </td>\r\n            </tr>\r\n          \r\n            <tr>\r\n              <td align=\"center\" style=\"font-size:0px;padding:5px 5px 5px 5px;word-break:break-word;\">\r\n                \r\n      \r\n     <!--[if mso | IE]>\r\n      <table\r\n         align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\"\r\n      >\r\n        <tr>\r\n      \r\n              <td>\r\n            <![endif]-->\r\n              <table align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"float:none;display:inline-table;\">\r\n                \r\n      <tr>\r\n        <td style=\"padding:4px;\">\r\n          <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"background:transparent;border-radius:3px;width:35px;\">\r\n            <tr>\r\n              <td style=\"font-size:0;height:35px;vertical-align:middle;width:35px;\">\r\n                <a href=\"https://www.facebook.com/MESCYT/\" target=\"_blank\" style=\"color: #0000EE;\">\r\n                    <img height=\"35\" src=\"https://s3-eu-west-1.amazonaws.com/ecomail-assets/editor/social-icos/simple/facebook.png\" style=\"border-radius:3px;display:block;\" width=\"35\">\r\n                  </a>\r\n                </td>\r\n              </tr>\r\n          </table>\r\n        </td>\r\n        \r\n      </tr>\r\n    \r\n              </table>\r\n            <!--[if mso | IE]>\r\n              </td>\r\n            \r\n              <td>\r\n            <![endif]-->\r\n              <table align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"float:none;display:inline-table;\">\r\n                \r\n      <tr>\r\n        <td style=\"padding:4px;\">\r\n          <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"background:transparent;border-radius:3px;width:35px;\">\r\n            <tr>\r\n              <td style=\"font-size:0;height:35px;vertical-align:middle;width:35px;\">\r\n                <a href=\"https://www.instagram.com/mescytrd/\" target=\"_blank\" style=\"color: #0000EE;\">\r\n                    <img height=\"35\" src=\"https://s3-eu-west-1.amazonaws.com/ecomail-assets/editor/social-icos/simple/instagram.png\" style=\"border-radius:3px;display:block;\" width=\"35\">\r\n                  </a>\r\n                </td>\r\n              </tr>\r\n          </table>\r\n        </td>\r\n        \r\n      </tr>\r\n    \r\n              </table>\r\n            <!--[if mso | IE]>\r\n              </td>\r\n            \r\n              <td>\r\n            <![endif]-->\r\n              <table align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"float:none;display:inline-table;\">\r\n                \r\n      <tr>\r\n        <td style=\"padding:4px;\">\r\n          <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"background:transparent;border-radius:3px;width:35px;\">\r\n            <tr>\r\n              <td style=\"font-size:0;height:35px;vertical-align:middle;width:35px;\">\r\n                <a href=\"https://www.youtube.com/user/mescyt/videos\" target=\"_blank\" style=\"color: #0000EE;\">\r\n                    <img height=\"35\" src=\"https://s3-eu-west-1.amazonaws.com/ecomail-assets/editor/social-icos/simple/youtube.png\" style=\"border-radius:3px;display:block;\" width=\"35\">\r\n                  </a>\r\n                </td>\r\n              </tr>\r\n          </table>\r\n        </td>\r\n        \r\n      </tr>\r\n    \r\n              </table>\r\n            <!--[if mso | IE]>\r\n              </td>\r\n            \r\n              <td>\r\n            <![endif]-->\r\n              <table align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"float:none;display:inline-table;\">\r\n                \r\n      <tr>\r\n        <td style=\"padding:4px;\">\r\n          <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"background:transparent;border-radius:3px;width:35px;\">\r\n            <tr>\r\n              <td style=\"font-size:0;height:35px;vertical-align:middle;width:35px;\">\r\n                <a href=\"https://twitter.com/MESCYTRD\" target=\"_blank\" style=\"color: #0000EE;\">\r\n                    <img height=\"35\" src=\"https://s3-eu-west-1.amazonaws.com/ecomail-assets/editor/social-icos/simple/twitter.png\" style=\"border-radius:3px;display:block;\" width=\"35\">\r\n                  </a>\r\n                </td>\r\n              </tr>\r\n          </table>\r\n        </td>\r\n        \r\n      </tr>\r\n    \r\n              </table>\r\n            <!--[if mso | IE]>\r\n              </td>\r\n            \r\n          </tr>\r\n        </table>\r\n      <![endif]-->\r\n    \r\n    \r\n              </td>\r\n            </tr>\r\n          \r\n      </table>\r\n    \r\n      </div>\r\n    \r\n          <!--[if mso | IE]>\r\n            </td>\r\n          \r\n        </tr>\r\n      \r\n                  </table>\r\n                <![endif]-->\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n        \r\n      </div>\r\n    \r\n      \r\n      <!--[if mso | IE]>\r\n          </td>\r\n        </tr>\r\n      </table>\r\n      \r\n      <table\r\n         align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"\" style=\"width:600px;\" width=\"600\"\r\n      >\r\n        <tr>\r\n          <td style=\"line-height:0px;font-size:0px;mso-line-height-rule:exactly;\">\r\n      <![endif]-->\r\n    \r\n      \r\n      <div style=\"background:#004a98;background-color:#004a98;margin:0px auto;max-width:600px;\">\r\n        \r\n        <table align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"background:#004a98;background-color:#004a98;width:100%;\">\r\n          <tbody>\r\n            <tr>\r\n              <td style=\"direction:ltr;font-size:0px;padding:0px 0px 0px 0px;text-align:center;\">\r\n                <!--[if mso | IE]>\r\n                  <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">\r\n                \r\n        <tr>\r\n      \r\n            <td\r\n               class=\"\" style=\"vertical-align:top;width:600px;\"\r\n            >\r\n          <![endif]-->\r\n            \r\n      <div class=\"mj-column-per-100 outlook-group-fix\" style=\"font-size:0px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%;\">\r\n        \r\n      <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"vertical-align:top;\" width=\"100%\">\r\n        \r\n            <tr>\r\n              <td align=\"center\" style=\"font-size:0px;padding:0px 35px 15px 35px;word-break:break-word;\">\r\n                \r\n      <div style=\"font-family:Ubuntu, Helvetica, Arial, sans-serif;font-size:11px;line-height:1.5;text-align:center;color:#FFFFFF;\"><p style=\"font-size: 12px; font-family: Poppins, sans-serif;\"><span style=\"text-decoration: underline; color: rgb(255, 255, 255);\"><span style=\"font-size: 12px;\">Si no quieres recibir nuestros correos, puedes <strong>cancelar tu suscripcion aqui</strong><a style=\"color: rgb(255, 255, 255); text-decoration: underline;\" href=\"*|UNSUB|*\">.</a></span></span></p></div>\r\n    \r\n              </td>\r\n            </tr>\r\n          \r\n      </table>\r\n    \r\n      </div>\r\n    \r\n          <!--[if mso | IE]>\r\n            </td>\r\n          \r\n        </tr>\r\n      \r\n                  </table>\r\n                <![endif]-->\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n        \r\n      </div>\r\n    \r\n      \r\n      <!--[if mso | IE]>\r\n          </td>\r\n        </tr>\r\n      </table>\r\n      <![endif]-->\r\n    \r\n    \r\n      </div>\r\n    \r\n      </body>\r\n    </html>",
                IsBodyHtml = true,
            };

            var filename = legalizationDetails.DocumentPath;
            mailMessage.Attachments.Add(new Attachment(filename));


            mailMessage.To.Add(legalizationDetails?.User?.Email ?? username);

            smtpClient.Send(mailMessage);
        }
    }
}
